import{j as e,a as t,o as a,z as s,B as n,E as i,u as r,J as o,M as l,N as d,F as c,H as u,G as g,C as m,O as p}from"./vendor-CBBAIpTX.js";import{p as w,t as f,r as y,P as h,u as b,a as x,b as v,c as I,d as P,e as j,l as U,f as k,g as A,h as _,i as O,j as S,k as L,m as T}from"./main-LE54y1pd.js";const E={class:"container",id:"registerSignup"},C=n("img",{class:"mb-4",src:""},null,-1),D={class:"h3 mb-3 fw-normal"},Q=["autocomplete"],M={key:0},Z=n("p",{class:"mt-3"},"Choose the timezone (of the market) your trades will be located and imported from.",-1),N=["value"],R=["disabled"],V={key:0,class:"ms-2 spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},q={key:0,class:"text-center mt-3"},z=["href"],W={__name:"LoginRegister",setup(W){const B=e({username:null,password:null,timeZone:"America/New_York"}),F=t(!1);let G=[];async function H(){return new Promise((e,t)=>{P.post("/api/updateSchemas").then(t=>{G=t.data.existingSchema,e(t)}).catch(e=>{t(e)})})}const J=async e=>new Promise(async(e,t)=>{const a=async()=>{await k(),G.includes("patterns")&&await(async()=>new Promise(async(e,t)=>{const a=h.Object.extend("patterns"),s=new h.Query(a),n=await s.find();if(n.length>0){for(let i=0;i<n.length;i++){const r=n[i];function o(e,t){return Math.max(e,t)}const l=o(S(O),L(T));let d={};d.id="tag_"+(l+1).toString(),d.name=r.get("name"),T.push(d)}e()}else alert("Updating trade tags did not return any results")}))(),G.includes("mistakes")&&await(async()=>new Promise(async(e,t)=>{const a=h.Object.extend("mistakes"),s=new h.Query(a),n=await s.find();if(n.length>0){for(let i=0;i<n.length;i++){const r=n[i];function o(e,t){return Math.max(e,t)}const l=o(S(O),L(T));let d={};d.id="tag_"+(l+1).toString(),d.name=r.get("name"),T.push(d)}e()}else alert("Updating trade tags did not return any results")}))(),await A(),await _("updateAvailableTagsWithPatterns")},s=async()=>{await k(),G.includes("setups")&&await n(),await _("updateSetupsToTags")},n=async()=>new Promise(async(e,t)=>{const a=h.Object.extend("setups"),s=new h.Query(a);s.include("pattern"),s.include("mistake");const n=await s.find();if(n.length>0){for(let e=0;e<n.length;e++){let t=[];const a=n[e];let s=O.findIndex(e=>"group_0"==e.id);const i=async e=>{let a=O[s].tags.findIndex(t=>t.name==e);-1!=a&&t.push(O[s].tags[a])};if(null!=a.get("pattern")&&""!=a.get("pattern")){i(a.get("pattern").get("name"))}if(null!=a.get("mistake")&&""!=a.get("mistake")){i(a.get("mistake").get("name"))}if(t.length>0){const e=new(h.Object.extend("tags"));e.set("user",h.User.current()),e.set("tags",t),e.set("dateUnix",a.get("dateUnix")),e.set("tradeId",a.get("tradeId")),e.setACL(new h.ACL(h.User.current())),e.save().then(async e=>{},e=>{})}}e()}else e()}),i=async()=>{G.includes("setups")&&await(async()=>new Promise(async(e,t)=>{const a=h.Object.extend("setups"),s=new h.Query(a),n=await s.find();if(n.length>0){for(let e=0;e<n.length;e++){const t=n[e];if(null!=t.get("note")&&""!=t.get("note")){const e=new(h.Object.extend("notes"));e.set("user",h.User.current()),e.set("note",t.get("note")),e.set("dateUnix",t.get("dateUnix")),e.set("tradeId",t.get("tradeId")),e.setACL(new h.ACL(h.User.current())),e.save().then(async e=>{},e=>{})}}e()}else e()}))(),await _("updateNotes")},r=async()=>new Promise(async(e,t)=>{G.includes("tags")&&await(async()=>new Promise(async(e,t)=>{const a=h.Object.extend("tags"),s=new h.Query(a),n=await s.find();if(n.length>0){for(let e=0;e<n.length;e++){const t=n[e];if(null!=t.get("tags")&&t.get("tags").length>0){let e=[];for(let a=0;a<t.get("tags").length;a++){const s=t.get("tags")[a];e.push(s.id)}t.set("tags",e),t.save().then(async e=>{},e=>{})}}e()}else e()}))(),await _("updateTagsArray"),e()}),o=async()=>{await(async()=>new Promise(async(e,t)=>{const a=h.Object.extend("diaries"),s=new h.Query(a),n=await s.findAll();if(n.length>0){for(let e=0;e<n.length;e++){const t=n[e];null!=t.get("journal")&&""!=t.get("journal")&&(t.set("diary",Object.values(t.get("journal")).join("")),t.save().then(async e=>{},e=>{}))}e()}else e()}))(),await _("updateDiary")};if(await j(),null==U||0==U.length)await a(),await s(),await i(),await r(),await o();else if(U.length>0){-1==U.findIndex(e=>"updateAvailableTagsWithPatterns"==e.name)&&await a(),-1==U.findIndex(e=>"updateSetupsToTags"==e.name)&&await s(),-1==U.findIndex(e=>"updateNotes"==e.name)&&await i(),-1==U.findIndex(e=>"updateTagsArray"==e.name)&&await r(),-1==U.findIndex(e=>"updateDiary"==e.name)&&await o()}e()});return(e,t)=>(a(),s("main",E,[n("form",{class:"text-center col-md-4 offset-md-4 mt-5",onSubmit:t[3]||(t[3]=p(e=>"login"==r(w)?async function(){if(F.value=!0,!localStorage.getItem("parse_app_id"))return void alert("Missing App ID. Please make sure you entered correct App ID during runtime.");if(200==(await H()).status)try{await h.User.logIn(B.username,B.password),b(),x(),await v(),await I(),await J(),F.value=!1,window.location.replace("/dashboard")}catch(e){F.value=!1,alert("Error: "+e.code+" "+e.message)}else F.value=!1,alert("Error updating schema "+H)}():async function(){if(F.value=!0,!localStorage.getItem("parse_app_id"))return void alert("Missing App ID. Please make sure you entered correct App ID during runtime.");if(200==(await H()).status){const t=new h.User;t.set("username",B.username),t.set("password",B.password),t.set("email",B.username),t.set("timeZone",B.timeZone);try{await t.signUp(),b(),x(),await v(),await I(),window.location.replace("/dashboard")}catch(e){alert("Error: "+e.code+" "+e.message)}}else F.value=!1,alert("Error updating schema "+H)}(),["prevent"]))},[C,n("h1",D,i("login"==r(w)?"Please Log in":"Please Register"),1),o(n("input",{type:"email",id:"inputEmail",class:"form-control",placeholder:"Email",required:"",autofocus:"","onUpdate:modelValue":t[0]||(t[0]=e=>B.username=e),autocomplete:"username"},null,512),[[l,B.username]]),o(n("input",{type:"password",id:"inputPassword",class:"mt-1 form-control",placeholder:"Password",required:"","onUpdate:modelValue":t[1]||(t[1]=e=>B.password=e),autocomplete:"login"==r(w)?"current-password":"new-password"},null,8,Q),[[l,B.password]]),"register"==r(w)?(a(),s("div",M,[Z,o(n("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>B.timeZone=e),class:"form-select"},[(a(!0),s(c,null,u(r(f),e=>(a(),s("option",{key:e.value,value:e},i(e),9,N))),128))],512),[[d,B.timeZone]])])):g("",!0),n("button",{class:"mt-3 w-100 btn btn-lg btn-primary",type:"submit",disabled:F.value},[m(i("login"==r(w)?"LogÂ in":"Register"),1),F.value?(a(),s("span",V)):g("",!0)],8,R)],32),r(y)?g("",!0):(a(),s("div",q,[n("a",{href:"login"==r(w)?"/register":"/"},i("login"==r(w)?"Register":"Login"),9,z),m(" page")]))]))}};export{W as _};
