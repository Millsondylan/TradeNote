import{a,x as e,z as s,f as n,J as l,K as t,u as i,B as o,C as d,P as u,M as r,F as c,H as p,o as m,G as y,E as x}from"./vendor-CBBAIpTX.js";import{M as v,N as b,O as f,Q as h,R as g,S as w,T as U,U as k,B as E,bY as I,ae as P,bZ as T,am as j,b_ as F,ax as M,b$ as B,aB as _,c0 as A,c1 as C,c2 as S,c3 as V,c4 as z}from"./main-LE54y1pd.js";import{_ as G}from"./SpinnerLoadingPage-SCQtX8pf.js";import"./capacitor-3Yedw1XA.js";import"./ui-Bs04w-Y-.js";const H={class:"row mt-2"},J={key:0},K=o("div",{class:"col-3"},null,-1),L=o("div",{class:"col-3"},null,-1),N={style:{display:"inline-flex","align-items":"center","flex-wrap":"wrap"}},O={key:0,class:"me-1"},Q={key:1,class:"me-1"},R={key:2},Y={key:0},Z={key:3,class:"ms-1"},$=o("button",{type:"cancel",onclick:"location.href = 'dashboard';",class:"btn btn-outline-secondary btn-sm me-2"},"Cancel",-1),q={key:1},D=o("a",{href:"/settings"},"settings",-1),W={__name:"AddExcursions",setup(W){v.extend(b),v.extend(f),v.extend(h),v.extend(g),v.extend(w),v.extend(U),v.extend(k),E.value=!1;const X=a(-1),aa=a(null);let ea=[],sa=a([]),na=[],la=[],ta=null,ia=null,oa=[];e(async()=>{await I(),X.value=-1;let a=P.findIndex(a=>"databento"===a.provider),e=P.findIndex(a=>"polygon"===a.provider);a>-1&&""!=P[a].key?(X.value=a,aa.value="databento"):e>-1&&""!=P[e].key&&(X.value=e,aa.value="polygon"),da()});const da=async()=>{await Promise.all([T(),j()]),sa.value.length=0,na=[],F.value.length>0&&F.value.forEach(async a=>{-1==M.findIndex(e=>e.dateUnix==a.dateUnix)&&v(1e3*a.dateUnix).isBefore(v().subtract(B.value,"days"))&&(sa.value.push(a.dateUnix),a.trades.forEach(a=>{na.push(a)}),ta?a.dateUnix<ta&&(ta=a.dateUnix):ta=a.dateUnix,ia?a.dateUnix>ia&&(ia=a.dateUnix):ia=a.dateUnix,a.trades.forEach(a=>{if(-1==la.findIndex(e=>e.symbol==a.symbol)){let e={};e.symbol=a.symbol,e.secType=a.type,la.push(e)}}))})},ua=async()=>new Promise(async(a,e)=>{E.value=!0,oa=[],ea=await C(aa.value,"manual",la,ta,ia),await na.forEach(async a=>{0==a.openPosition&&(oa=await S(a,a.entryTime,a.entryPrice,a,ea))}),oa.length>0&&await V(null,null),E.value=!1,z("daily")});return(a,e)=>(m(),s(c,null,[n(G),l(o("div",H,[o("div",null,[-1!=X.value?(m(),s("div",J,[K,L,o("div",null,[o("p",N,[d(" For the past "),l(o("input",{type:"number",class:"form-control ms-2 me-2 inputText","onUpdate:modelValue":e[0]||(e[0]=a=>u(A)?A.value=a:null),onInput:e[1]||(e[1]=a=>da())},null,544),[[r,i(A)]]),d(" days and with a "),l(o("input",{type:"number",class:"form-control ms-2 me-2 inputText","onUpdate:modelValue":e[2]||(e[2]=a=>u(B)?B.value=a:null),onInput:e[3]||(e[3]=a=>da()),style:{width:"70px","vertical-align":"baseline"}},null,544),[[r,i(B)]]),d(" day "),i(B)>1?(m(),s("span",O,"s")):(m(),s("span",Q)),d(" margin, "),i(sa).length>0?(m(),s("span",R,[d("the MFE prices for the following dates are missing: "),(m(!0),s(c,null,p(i(sa),(a,e)=>(m(),s("span",null,[e>0?(m(),s("span",Y,", ")):y("",!0),d(x(i(_)(a)),1)]))),256))])):(m(),s("span",Z,"all MFE prices have been updated."))])]),l(o("button",{type:"button",onClick:ua,class:"btn btn-success btn-lg me-3"},"Add",512),[[t,i(sa).length>0&&!i(E)]]),$])):(m(),s("div",q,[d("To add MFE prices automatically, insert your API key in "),D,d(".")]))])],512),[[t,!i(E)]])],64))}};export{W as default};
